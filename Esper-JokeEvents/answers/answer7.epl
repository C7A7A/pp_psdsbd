@name('answer')
    select * from JokeEvent
    match_recognize (
        partition by pub
        measures
            A.pub as pub,
            A.laughing_people as ppl_before,
            last(B.laughing_people) as ppl_after,
            count(B.pub) as joke_count
        pattern (A B{4,} C)
        define
            B as B.laughing_people < A.laughing_people and B.laughing_people < prev(B.laughing_people),
            C as C.laughing_people > B.LastOf().laughing_people
    )